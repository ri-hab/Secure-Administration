<html>
<head>
  <style>
  body { background-color: #666; }
</style>
{% load static %}
<!--termianl css-->
<link rel="stylesheet" href="{% static 'plugins/xterm/xterm.css' %}"/>
</head>
<body>
    <div id="terminal_monitor"> </div>
</body>
<!-- jQuery 2.2.3 -->
<script src="{% static 'plugins/jQuery/jquery-2.2.3.min.js' %}"></script>
<script src="{% static 'plugins/jquery-ui/jquery-ui.min.js' %}"></script>
<script src="{% static 'plugins/jquery.fullscreen/jquery.fullscreen.min.js' %}"></script>
<script src="{% static 'plugins/bootbox/bootbox.js' %}"></script>
<script src="{% static 'plugins/xterm/xterm.js' %}"></script>
<script src="{% static 'plugins/xterm/addons/fullscreen/fullscreen.js' %}"></script>
<script src="{% static 'plugins/xterm/addons/fit/fit.js' %}"></script>
<script src="{% static 'plugins/xterm/addons/attach/attach.js' %}"></script>
<script src="{% static 'plugins/xterm/addons/terminado/terminado.js' %}"></script>

<script type="application/javascript">
    $(document).ready(function () {
        var ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";
        var ws_path = ws_scheme + '://' + window.location.host + '/monitor/' + 'monitor-' + '{{logs.log}}';
        console.log(ws_path);
        console.log("object.log: ", '{{logs.log}}');
        console.log("object.height: ", '{{logs.height}}');
        console.log("object.width: ", '{{logs.width}}');
        make_terminal(document.getElementById('terminal_monitor'), {rows: '{{logs.height}}', cols: '{{logs.width}}'}, ws_path);
    })
    var terminals = new Object;
    Terminal.applyAddon(fullscreen);
    Terminal.applyAddon(fit);
    Terminal.applyAddon(attach);

    function make_terminal(element, size, ws_url) {
      Terminal.applyAddon(fullscreen);
      Terminal.applyAddon(fit);
      Terminal.applyAddon(attach);
      var term = new Terminal({
          cols: size.cols,
          rows: size.rows,
          screenKeys: true,
          useStyle: true,
          cursorBlink: true,  // Blink the terminal's cursor
      });
      term.open(element, false);
      var ws = new WebSocket(ws_url);
      ws.onopen = function (event) {
          term.resize(term.cols, term.rows);
          //term.toggleFullscreen(true);
          ws.onmessage = function (event) {
              json_msg = JSON.parse(event.data);
              switch (json_msg[0]) {
                  case "stdout":
                      term.write(json_msg[1]);
                      break;
                  case "disconnect":
                      term.write("\r\n\r\n[Finished...]\r\n");
                      break;
              }
          };
      };
      return {socket: ws, term: term};
  }
</script>
</html>
